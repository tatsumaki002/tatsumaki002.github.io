<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>IIS漏洞PUT任意文件上传复现</title>
      <link href="/2020/06/07/sort-algorithms/"/>
      <url>/2020/06/07/sort-algorithms/</url>
      
        <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>因为懒得搭环境，所以直接用了墨者学院的靶场。</p><p>产生PUT任意文件上传的原因在于使用IIS开启了webDAV。问题来了，什么是webDVA？</p><p>简单来说，webDAV是基于HTTP 1.1的通信协议，使得在除了GET、POST、HEAD这几种常见的请求方式之外，还能使用像是PUT、MOVE、COPY这些方法。</p><p>问题就出在了这里，一般的网站根本不需要用到这些多的请求，在开启webDAV、而且还选了可写入这个选项之后，就能造成任意文件上传（伪）。</p><h2 id="漏洞复现"><a href="#漏洞复现" class="headerlink" title="漏洞复现"></a>漏洞复现</h2><blockquote><p>中间件漏洞</p></blockquote><p>理解差不多的原理之后，再看墨者的这个靶场，使用的是IIS6.0，直接使用OPTIONS方法。如果开启了webDAV的话，OPTIONS方法能够显示支持的请求。</p><p><img src="1.png" alt="OPTIONS请求的回显"></p><p>显然开启了webDAV，那么使用PUT方法上传一句话木马。IIS6.0默认可执行文件为asp，所以使用asp的一句话马。</p><p>为什么说是任意文件上传（伪），因为上传的文件后缀名不能是asp，只能传txt这种。</p><p><img src="2.png" alt="PUT上传文件"></p><p>回显201，显示创造成功。</p><p>但是因为是txt，无法利用。因此使用MOVE或者COPY，将文件移动成asp后缀脚本</p><p>传asp传不上去（图没截），因为环境是IIS6.0，那就用IIS6.0的分号解析漏洞，上传;.txt</p><p><img src="3.png" alt="利用解析漏洞生成可执行文件"></p><p>这里似乎是墨者靶场的回显码有错误。</p><p>如果是自己搭建环境的话，出现了回显207，需要勾选可执行脚本资源这个选项，就能正常利用了。</p><p>访问/shell.asp;.txt，页面虽然空白但证实的确存在，用蚁剑连接，找到key。</p><p><img src="4.png" alt="连接"></p><p>至此复现完成，因能力有限，如果本文中有什么不对之处，烦请读者于评论区中指出错误，谢谢！</p>]]></content>
      
      
      <categories>
          
          <category> 漏洞复现 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 墨者靶场WP </tag>
            
            <tag> 中间件漏洞 </tag>
            
            <tag> 漏洞复现 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
